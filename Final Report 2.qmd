---
title: "VEREP Property Development Analysis"
author: "HDAdvisors"
date: today
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-summary: "Show code"
    embed-resources: true
  pdf:
    toc: true
    toc-depth: 3
    geometry:
      - margin=1in
    mainfont: "Lato"
    sansfont: "Lato"
execute:
  warning: false
  message: false
---

```{css}
#| echo: false

@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Lato:wght@300;400;700&display=swap');

/* Apply HDA fonts */
body {
  font-family: 'Lato', sans-serif;
  color: #333333;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Roboto Slab', serif;
  color: #445ca9;
}

/* Style callouts with HDA colors */
.callout-note {
  border-left-color: #445ca9 !important;
}

.callout-warning {
  border-left-color: #e76f52 !important;
}

.callout-tip {
  border-left-color: #8baeaa !important;
}

/* Style links */
a {
  color: #445ca9;
}

a:hover {
  color: #e9ab3f;
}
```

## Executive Summary
- Brief overview of the top 10 developable properties
- Key findings and recommendations
- Quick reference table/map

## 1. Background & Data Sources
### 1.1 VEREP Parcel Dataset Methodology
[Condensed version of the CGS methodology summary]

### 1.2 Congregation Statistics
- What metrics are available (attendance, pledge, membership)
- Time period covered (2014-2023)
- Data quality considerations

## 2. Analytical Approach

### 2.1 Solving the One-to-Many Join Problem
```{r congregation-join}
# Your approach to handling parcels with multiple congregations
# Document decisions: average metrics? primary congregation? all combinations?
```

### 2.2 Defining "Developability"
Create a scoring framework based on:
```{r developability-criteria}
# Property characteristics:
# - Parcel size (adequate for development?)
# - Current use (underutilized parking lots? vacant land?)
# - Zoning favorability
# - Not in flood zones/wetlands

# Financial indicators:
# - Assessed value vs. potential
# - Congregation financial health (declining pledges = need for income?)

# Location factors:
# - Walkability score
# - Transit access
# - Median income (market demand)
# - Urban vs. rural

# Regulatory ease:
# - Not in historic districts
# - Not encumbered by easements
# - LIHTC qualified census tract (for affordable housing incentives)

```

### 2.3 Scoring Methodology
```{r scoring-system}
# Weighted composite score
# Normalize each criterion to 0-100 scale
# Apply weights based on VEREP priorities
# Calculate total development potential score

calculate_dev_score <- function(df) {
  df %>%
    mutate(
      # Size score (0-100)
      size_score = case_when(
        area_acres < 0.25 ~ 20,
        area_acres < 0.5 ~ 50,
        area_acres < 2 ~ 80,
        TRUE ~ 100
      ),
      
      # Use type score (parking/open space = higher)
      use_score = case_when(
        use_parking == "Yes" ~ 90,
        use_open_space == "Yes" ~ 85,
        use_cemetery == "Yes" ~ 10,
        use_church == "Yes" ~ 30,
        TRUE ~ 50
      ),
      
      # Location score
      location_score = scales::rescale(walkability_score, to = c(0, 100)),
      
      # Financial need score (declining congregations = higher need)
      financial_score = scales::rescale(-pct_change_pledge, to = c(0, 100)),
      
      # Constraint penalty
      constraint_penalty = case_when(
        flood_zone != "None" ~ -30,
        historic_district == "Yes" ~ -20,
        easement == "Yes" ~ -25,
        wetlands_pct > 10 ~ -15,
        TRUE ~ 0
      ),
      
      # Composite score
      development_score = (size_score * 0.25 + 
                          use_score * 0.25 + 
                          location_score * 0.20 +
                          financial_score * 0.15 +
                          zoning_score * 0.15) + constraint_penalty
    )
}

```

## 3. Analysis & Results

### 3.1 Congregation-Parcel Integration
```{r join-results}
# Show how you resolved the many-to-many issue
# Summary statistics of joined dataset
# Data quality checks

```

### 3.2 Development Potential Scoring
```{r score-distribution}
# Distribution of scores across all parcels
# Visualization of scoring components
# Identify high-potential clusters
```

### 3.3 Top 10 Developable Properties
```{r top-10-analysis}
# Detailed profiles of top 10
# Maps showing locations
# Comparative analysis

# Create interactive map of top 10
top_10 <- scored_parcels %>%
  arrange(desc(development_score)) %>%
  slice_head(n = 10)

library(leaflet)
leaflet(top_10) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~colorNumeric("YlOrRd", development_score)(development_score),
    weight = 2,
    popup = ~paste0(
      "<b>", site_address, "</b><br>",
      "Score: ", round(development_score, 1), "<br>",
      "Size: ", round(area_acres, 2), " acres<br>",
      "Congregation: ", congregation_name
    )
  )

# Comparative radar/spider chart of top properties
library(fmsb)
# Show how each property scores on different dimensions

```

## 4. Property Profiles

### Property 1: [Name/Address]
- Parcel characteristics
- Congregation context (health metrics, trends)
- Development opportunities
- Considerations/constraints

[Repeat for each top 10]

```{r}
create_property_profile <- function(parcel_id) {
  property <- scored_parcels %>% filter(parcel_id == {{parcel_id}})
  
  cat("## Property Profile: ", property$site_address, "\n\n")
  
  cat("**Development Score:**", round(property$development_score, 1), "\n\n")
  
  cat("### Property Characteristics\n")
  # Generate summary table
  
  cat("### Congregation Context\n")
  # Pull congregation trends
  
  cat("### Development Opportunities\n")
  # Text based on scoring components
  
  cat("### Key Considerations\n")
  # Flag constraints
}
```


## 5. Recommendations & Next Steps

## Appendices
- Full methodology
- Data dictionary
- Additional maps/tables