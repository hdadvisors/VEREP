## Developable Land Summary

```{r}
#| include: false
source("R/common.R")
```

### Comprehensive Developability Analysis

```{r developable-summary, echo=FALSE}
# Summary of ALL developable land (not just top 10)
developable_summary <- property_profile |>
  filter(development_score >= 45) |>  # Tier 3 and above
  summarise(
    n_developable = n(),
    total_dev_acres = sum(area_acres, na.rm = TRUE),
    total_dev_value = sum(assessed_value, na.rm = TRUE),
    avg_attendance = mean(avg_attendance, na.rm = TRUE),
    avg_pledge = mean(avg_pledge, na.rm = TRUE),
    parcels_under_30 = sum(avg_attendance < 30, na.rm = TRUE)
  )

# By tier
tier_summary <- property_profile |>
  filter(development_score >= 45) |>
  group_by(development_potential) |>
  summarise(
    n_parcels = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    total_value = sum(assessed_value, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(n_parcels))
```

```{r output-dev-summary, echo=FALSE, results='asis'}
cat("**All Developable Properties (Score â‰¥45)**\n\n")

# Create stat boxes
cat("::: {layout-ncol=4}\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", developable_summary$n_developable, "\n:::\n", sep = "")
cat("::: {.stat-label}\nDevelopable Parcels\n:::\n:::\n\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", round(developable_summary$total_dev_acres, 1), "\n:::\n", sep = "")
cat("::: {.stat-label}\nDevelopable Acres\n:::\n:::\n\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n$", scales::comma(developable_summary$total_dev_value / 1e6, accuracy = 0.1), "M\n:::\n", sep = "")
cat("::: {.stat-label}\nAssessed Value\n:::\n:::\n\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", developable_summary$parcels_under_30, "\n:::\n", sep = "")
cat("::: {.stat-label}\nWith <30 Attendance\n:::\n:::\n\n")

cat(":::\n\n")

cat("### Breakdown by Development Tier\n\n")
```

```{r tier-breakdown-html}
tier_summary |>
  kable(
    col.names = c("Tier", "# Parcels", "Total Acres", "Assessed Value"),
    digits = c(0, 0, 1, 0),
    format.args = list(big.mark = ",")
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"))
```
