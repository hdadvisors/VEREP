# Executive Summary {.unnumbered}

This analysis examines properties in the Episcopal Diocese of Virginia with fewer than 30 Sunday attendees, focusing on development potential through five key metrics: land value, zoning/density, acreage, environmental limitations, and Qualified Census Tract (QCT) status. This report was done for VEREP (Virginia Episcopal Real Estate Partners) in conjunction with case study projects HDAdvisors is facilitating.

## At a Glance: Top 10 Properties

```{r}
#| echo: false
source("R/common.R")
source("R/app.R")

```

```{r}
#| label: tbl-top-dev
#| tbl-cap: "Top Development Opportunities"
#| echo: false

top_parcels |>
  select(rank, sadd, scity, rgisacre, development_tier) |>
  kable(
    col.names = c("Rank", "Address", "City", "Acres", "Tier"),
    digits = c(0, 0, 0, 2, 1, 0),
    align = c("c", "l", "l", "r", "r", "l")
  ) |>
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) |>
  column_spec(1, bold = TRUE, width = "3em") |>
  column_spec(5, color = "green", 
              background = spec_color(top_parcels$development_score, 
                                      scale_from = c(0, 100),
                                      palette = "YlOrRd",
                                      direction = -1))
```

```{r}
#| label: fig-tier-distribution
#| fig-cap: "Distribution of Properties by Development Potential"
#| fig-height: 4

tier_summary <- scored_parcels |>
  count(development_potential) |>
  mutate(
    pct = n / sum(n) * 100
  )

ggplot(tier_summary, aes(x = reorder(development_potential, n), y = n,
                          fill = development_potential)) +
  geom_col() +
  geom_text(aes(label = paste0(n, " (", round(pct, 1), "%)")), 
            vjust = -0.5, size = 3.5) +
  scale_fill_manual(values = c(
    "High" = "#445ca9",
    "Moderate" = "#8baeaa",
    "Constrained" = "#e9ab3f",
    "Limited" = "#e76f52"
  )) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x = "",
    y = "Number of Properties"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", color = "#445ca9"),
    axis.text.x = element_text(angle = 25, hjust = 1),
    panel.grid.major.x = element_blank(),
    legend.position = "none"
  )
```


## Key Findings

### Portfolio Summary

```{r}
#| label: portfolio-summary
#| echo: false
#| results: asis

# Calculate summary statistics
total_props <- nrow(scored_parcels)
high_potential <- sum(scored_parcels$development_potential == "High", na.rm = TRUE)
moderate_potential <- sum(scored_parcels$development_potential == "Moderate", na.rm = TRUE)
strong_potential <- high_potential 
total_acres <- sum(scored_parcels$area_acres, na.rm = TRUE)
top_parcels_acres <- sum(top_parcels$area_acres, na.rm = TRUE)

cat("::: {layout-ncol=4}\n\n")

cat("::: {.callout-note appearance='minimal'}\n")
cat("## ", total_props, "\n", sep = "")
cat("Parcels Analyzed\n")
cat(":::\n\n")

cat("::: {.callout-tip appearance='minimal'}\n")
cat("## ", strong_potential, "\n", sep = "")
cat("Strong Potential (High)\n")
cat(":::\n\n")

cat("::: {.callout-warning appearance='minimal'}\n")
cat("## ", round(top_parcels_acres, 1), "\n", sep = "")
cat("Top Developable Acres\n")
cat(":::\n\n")

cat("::: {.callout-important appearance='minimal'}\n")
cat("## ", round(total_acres, 0), "\n", sep = "")
cat("Total Portfolio Acres\n")
cat(":::\n\n")

cat(":::\n")
```

### Significant Underutilized Assets

```{r}
#| echo: false
#| results: asis

parking_count <- sum(scored_parcels$use_parking, na.rm = TRUE)
open_space_count <- sum(scored_parcels$use_open_space, na.rm = TRUE)
declining_count <- sum(scored_parcels$financial_need >= 2, na.rm = TRUE)

parking_acres <- sum(scored_parcels$area_acres[scored_parcels$use_parking == TRUE], na.rm = TRUE)
open_space_acres <- sum(scored_parcels$area_acres[scored_parcels$use_open_space == TRUE], na.rm = TRUE)
declining_acres <- sum(scored_parcels$area_acres[scored_parcels$financial_need >= 2], na.rm = TRUE)

cat("::: {layout-ncol=3}\n\n")

cat("::: {.callout-warning appearance='minimal'}\n")
cat("## ", parking_count, " Parcels (", round(parking_acres, 1), " acres)\n", sep = "")
cat("Surface Parking Lots\n")
cat(":::\n\n")

cat("::: {.callout-warning appearance='minimal'}\n")
cat("## ", open_space_count, " Parcels (", round(open_space_acres, 1), " acres)\n", sep = "")
cat("Vacant/Open Space\n")
cat(":::\n\n")

cat("::: {.callout-tip appearance='minimal'}\n")
cat("## ", declining_count, " Parcels (", round(declining_acres, 1), " acres)\n", sep = "")
cat("Financial Need Congregations\n")
cat(":::\n\n")

cat(":::\n")
```

---

This defines "need" as:

- `has_congregation == TRUE` (only sites with active congregations)
- declining congregations
- declining giving 


### Geographic Distribution

```{r}
#| label: fig-geographic-dists
#| fig-cap: "Properties by County"
#| fig-height: 4

county_summary <- scored_parcels |>
  count(scounty, name = "n_properties") |>
  arrange(desc(n_properties)) |>
  slice_head(n = 10)

ggplot(county_summary, aes(x = reorder(scounty, n_properties), y = n_properties)) +
  geom_col(fill = "#445ca9", alpha = 0.8) +
  geom_text(aes(label = n_properties), hjust = -0.2, size = 3.5) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Top 10 Counties by Property Count",
    x = "",
    y = "Number of Properties"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", color = "#445ca9"),
    panel.grid.major.y = element_blank()
  )
```

Development opportunities are distributed across Virginia, with concentrations in:

-   Urban/suburban areas with strong walkability scores
-   Markets with favorable demographics and LIHTC eligibility
-   Transit-accessible locations supporting reduced parking requirements

### Congregation Vitality Summary

```{r}
#| echo: false
#| results: asis

library(kableExtra)

# Calculate parcels per congregation
parcels_per_cong <- property_profile |>
  filter(has_congregation) |>
  count(congregation_name) |>
  summarise(avg_parcels = mean(n))

# Congregation statistics
cong_stats <- property_profile |>
  filter(has_congregation) |>
  distinct(congregation_name, .keep_all = TRUE) |>
  summarise(
    congregations_with_data = n(),
    congregations_under_30_attendance = sum(avg_attendance < 30, na.rm = TRUE),
    avg_attendance_all = mean(avg_attendance, na.rm = TRUE),
    avg_pledge_all = mean(avg_pledge, na.rm = TRUE),
    declining_pledges = sum(pct_change_pledge < 0, na.rm = TRUE),
    financial_need = sum(financial_need >= 2, na.rm = TRUE)
  )

# Build summary table
vitality_summary <- tibble(
  Metric = c(
    "Congregations with <30 Sunday Attendance",
    "Total Parcels Analyzed",
    "Average Parcels per Congregation",
    "Average Sunday Attendance",
    "Average Annual Pledge",
    "Congregations in Financial Need"
  ),
  Value = c(
    cong_stats$congregations_under_30_attendance,
    nrow(property_profile),
    round(parcels_per_cong$avg_parcels, 1),
    paste0(round(cong_stats$avg_attendance_all, 0), " people"),
    scales::dollar(cong_stats$avg_pledge_all, accuracy = 1),
    cong_stats$financial_need
  )
)

cat("### Congregation Vitality Summary\n\n")

vitality_summary |>
  kable(
    col.names = c("Metric", "Value"),
    align = c("l", "r")
  ) |>
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) |>
  row_spec(0, bold = TRUE, background = "#445ca9", color = "white") |>
  row_spec(c(1, 6, 7), bold = TRUE)
```




```
:::

## Next Steps

1.  **Priority Assessment**: Review top-ranked properties for immediate action
2.  **Feasibility Studies**: Conduct detailed feasibility analysis for top candidates
3.  **Stakeholder Engagement**: Engage relevant stakeholders for high-priority sites
4.  **Financial Planning**: Develop funding strategies and timelines
