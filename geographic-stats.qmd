## Geographic Summary

```{r}
#| include: false
source("R/common.R")
```

### Parcels by Diocesan Region

```{r}
#| label: tbl-by-county
#| tbl-cap: "Property Distribution by County"
#| echo: false

county_summary <- property_profile |>
  group_by(scounty) |>
  summarise(
    properties = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    avg_score = mean(development_score, na.rm = TRUE),
    high_potential = sum(development_potential == "High", na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(high_potential), desc(properties))

# Calculate totals
total_row <- tibble(
  scounty = "**TOTAL**",
  properties = sum(county_summary$properties),
  total_acres = sum(county_summary$total_acres),
  avg_score = mean(property_profile$development_score, na.rm = TRUE),
  high_potential = sum(county_summary$high_potential)
)

# Combine and format
county_summary |>
  bind_rows(total_row) |>
  mutate(
    total_acres = round(total_acres, 1),
    avg_score = round(avg_score, 1)
  ) |>
  kable(
    col.names = c("County", "Parcels", "Total Acres", "Avg Score", "# High Potential"),
    align = c("l", "r", "r", "r", "r"),
    escape = FALSE  # Allow markdown formatting for TOTAL
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
  row_spec(0, bold = TRUE, background = "#445ca9", color = "white") |>
  row_spec(nrow(county_summary) + 1, bold = TRUE, background = "#f0f0f0")  # Highlight total row
```
