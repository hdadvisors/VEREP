```{r}
#| include: false
source("R/common.R")
```


# Background & Data Sources

## VEREP Parcel Dataset

This analysis utilizes the Virginia Episcopal Real Estate Portfolio (VEREP) parcel dataset, compiled by CGS Consultants. The dataset (originally 790 parcels) was further filtered to look at parcels/properties with small congregations and includes:

```{r verep-count, echo=FALSE, results='asis'}
cat("- **", nrow(property_profile), " parcels** across Virginia\n", sep = "")
```

-   Comprehensive property characteristics (size, use, zoning)
-   Environmental constraints (floodplains, wetlands, easements)
-   Location metrics (walkability, transit access)
-   Market indicators (median income, demographics)

## Congregation Statistics (2014-2023)

This analysis also includes congregation statistics from the VEREP GIS webtool. Financial and membership data provides context on congregation health:

-   Sunday attendance trends
-   Membership changes
-   Plate & pledge revenue
-   10-year trend analysis

::: callout-note
## Data Quality Note

Not all properties have associated congregation data. Properties without congregation information received neutral scores in the financial need category.
:::

## Data Quality Issues

Of the 104 properties analyzed with fewer than 30 Sunday attendees, 101 (97.1%) have incomplete data — meaning they are missing at least one of the six key development metrics (land value, acreage, wetland coverage, flood zone, QCT status, or zoning). This high rate reflects broader data quality challenges identified in CGS's initial VEREP study.

While environmental constraint data (wetlands, flood zones) accounts for much of the missing information, 15 properties (14.4%) are missing land value entirely, limiting our ability to assess their financial potential. The breakdown below classifies these data gaps to help prioritize follow-up research. Once complete, these properties can be more precisely evaluated for development opportunities.

```{r other-issues, echo=FALSE}
# Calculate missing data breakdown
missing_breakdown <- incomplete_properties |>
  summarise(
    missing_land_value = sum(missing_land_value, na.rm = TRUE),
    missing_acreage = sum(missing_acreage, na.rm = TRUE),
    missing_wetland = sum(missing_wetland, na.rm = TRUE),
    missing_flood = sum(missing_flood, na.rm = TRUE),
    missing_qct = sum(missing_qct, na.rm = TRUE),
    missing_zoning = sum(missing_zoning, na.rm = TRUE)
  ) |>
  pivot_longer(everything(), names_to = "data_type", values_to = "count") |>
  mutate(
    data_type = str_remove(data_type, "missing_"),
    data_type = str_to_title(str_replace_all(data_type, "_", " "))
  ) |>
  arrange(desc(count))

# Calculate properties with address issues
props_with_incomplete_addr <- incomplete_properties |> 
  filter(is.na(sadd) | sadd == "" | grepl("UNASSIGNED|INCOMPLETE", sadd, ignore.case = TRUE)) |>
  nrow()

# Count address issues from unmatched data
unmatched_with_no_address <- no_match |>
  filter(is.na(sadd) | sadd == "") |>
  nrow()

address_issues <- props_with_incomplete_addr + unmatched_with_no_address

# Add Property Information row
missing_breakdown <- missing_breakdown |>
  add_row(
    data_type = "Property Information",
    count = address_issues
  ) |>
  arrange(desc(count))
```

```{r missing-data-chart, echo=FALSE, fig.height=4}
missing_breakdown |>
  filter(count > 0) |>  # Remove categories with no missing data
  ggplot(aes(x = reorder(data_type, count), y = count)) +
  geom_col(fill = "#e76f52", alpha = 0.8) +
  geom_text(aes(label = paste0(count, " (", round(count/nrow(incomplete_properties)*100, 1), "%)")), 
            hjust = -0.05, size = 3.5) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  labs(
    title = "Missing Data by Category",
    subtitle = paste0("Among ", nrow(incomplete_properties), " properties with incomplete data"),
    x = "",
    y = "Number of Properties"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", color = "#445ca9"),
    plot.subtitle = element_text(color = "#666666"),
    panel.grid.major.y = element_blank()
  )
```

We handled wetland qualifying differently from other categories because it accounted for the majority of missing data and was impacting our ability to determine any highly ranked development sites.For properties without wetland data, we applied a default value of 0%, operating under the assumption that parcels not captured in the National Wetlands Inventory contain no significant wetland features. Similarly, the 5 properties (4.8%) missing FEMA flood zone designations were assigned zone "X," indicating minimal flood hazard, consistent with areas outside mapped floodplains.

Acreage and QCT status were complete across all 101 properties. Land value and zoning data remained incomplete for 15 properties each (14.4%). These fields were retained as missing rather than imputed, as accurate values require verification through county assessor records and local zoning ordinances. Properties lacking these values are flagged for manual follow-up.

Following these adjustments, the number of properties with incomplete data decreased from 101 to approximately 25, representing those still requiring land value or zoning verification.

## Geocoding Process Summary

### Process

11 of the 104 parcels had missing or 'UNASSIGNED' addresses in the parcel database. For this analysis we used Geocodio API to geocode based on available city/county information. All 11 of these parcels geocoded to West Point, King William County center coordinates and likely belong to 2 congregations.

### Results

- **Geocoding success rate**: 100% (11/11 properties)
- **Accuracy level**: Medium (0.54) - 'street_center' approximation
- **Location**: West Point, King William County, Virginia
- **Congregations affected**: 2 (St Pauls Church, St Johns Episcopal Church)
- **Development classification**: All classified as 'Small Parcel' or environmentally constrained

### Interpretation

These properties lack specific street addresses in the Virginia parcel data. The geocoding service returned city-center coordinates as approximations based on the available location information (city and county).

This geocoding approach is acceptable for the purposes of this report because:

- All properties are small parcels (< 0.5 acres)
- None qualify as high or medium development opportunities
- They are correctly excluded from the 'top opportunities' analysis
- Approximate coordinates are sufficient for general mapping and visualization purposes

### Impact on Analysis

✓ **No impact** on top opportunities identification  
✓ All 104 properties now have coordinates for mapping and spatial analysis  
✓ Small parcels appropriately filtered from priority development list  
✓ Development potential classifications remain accurate

### Recommendation

Accept city-center approximations for mapping and visualization purposes. Manual address research is not necessary as these parcels are not development priorities due to size constraints. The geocoding has successfully provided the minimum necessary location information for comprehensive spatial analysis of the property portfolio.