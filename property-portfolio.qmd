# Property Portfolio Overview

```{r}
#| include: false
source("R/common.R")
```

## Portfolio Summary

```{r}
#| label: portfolio-metrics
#| results: asis
#| echo: false

# Calculate key metrics
total_properties <- nrow(property_profile)
total_acres <- sum(property_profile$area_acres, na.rm = TRUE)
avg_score <- mean(property_profile$development_score, na.rm = TRUE)
high_potential <- sum(property_profile$development_potential == "High", na.rm = TRUE)

cat("::: {layout-ncol=4}\n\n")

cat("::: {.callout-note appearance='minimal'}\n")
cat("## ", total_properties, "\n", sep = "")
cat("Total Parcels Analyzed\n")
cat(":::\n\n")

cat("::: {.callout-tip appearance='minimal'}\n")
cat("## ", format(round(total_acres, 0), big.mark = ","), "\n", sep = "")
cat("Total Acres Analyzed\n")
cat(":::\n\n")

cat("::: {.callout-warning appearance='minimal'}\n")
cat("## ", round(avg_score, 1), "\n", sep = "")
cat("Avg Development Score\n")
cat(":::\n\n")

cat("::: {.callout-important appearance='minimal'}\n")
cat("## ", high_potential, "\n", sep = "")
cat("High Potential Properties\n")
cat(":::\n\n")

cat(":::\n")
```
The distribution of development potential reflected in this analysis is common in institutional portfolios where properties were acquired for mission, not market value. The analysis's value lies in identifying the needles in the haystack—the 16 high-priority and 23 moderate-priority properties that can actually deliver financial returns—rather than pretending the entire portfolio has equal potential.

**In short:** A median development score of 35 proves the methodology is honest, makes the high-scoring properties more valuable by contrast, and provides clear strategic guidance: focus resources where they'll succeed rather than spreading them thin across a portfolio where most properties face fundamental limitations.

## Property Use Types

```{r}
#| label: fig-use-types
#| fig-cap: "Distribution of Properties by Primary Use"
#| fig-height: 5
#| echo: false

# Summarize use types
use_summary <- property_profile |>
  summarise(
    Church = sum(use_church, na.rm = TRUE),
    Parking = sum(use_parking, na.rm = TRUE),
    `Open Space` = sum(use_open_space, na.rm = TRUE),
    Residence = sum(use_residence, na.rm = TRUE),
    School = sum(use_school, na.rm = TRUE),
    Cemetery = sum(use_cemetery, na.rm = TRUE)
  ) |>
  pivot_longer(everything(), names_to = "Use Type", values_to = "Count") |>
  filter(Count > 0) |>
  arrange(desc(Count)) |>
  mutate(pct = Count / sum(Count) * 100)

ggplot(use_summary, aes(x = reorder(`Use Type`, Count), y = Count, fill = `Use Type`)) +
  geom_col() +
  geom_text(aes(label = paste0(Count, " (", round(pct, 1), "%)")), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_fill_manual(values = c(
    "Church" = "#445ca9",
    "Parking" = "#8baeaa",
    "Open Space" = "#e9ab3f",
    "Residence" = "#e76f52",
    "School" = "#9b59b6",
    "Cemetery" = "#7f8c8d"
  )) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.2))) +
  labs(
    title = "Properties by Use Type",
    x = "",
    y = "Number of Properties"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", color = "#445ca9"),
    panel.grid.major.y = element_blank(),
    legend.position = "none"
  )
```

Over two-thirds (71%) of parcels are locked into church and cemetery designations—uses that inherently limit redevelopment options due to zoning, community sensitivity, and legal restrictions. Only about 29% of the portfolio consists of property types (open space, parking, residence) that would typically command higher valuations or offer more flexible development opportunities. 

## Development Score Distribution

The development scoring confirms use-constraints. Focus should likely center on the 16 high-potential properties for near-term value creation, while developing a longer-term strategy for the 23 moderate-potential parcels. The 59 constrained and size-restrictive properties may require hold strategies, community partnerships, or creative repurposing rather than traditional development approaches.

```{r}
#| label: fig-score-distribution
#| fig-cap: "Distribution of Development Scores Across Portfolio"
#| fig-height: 4
#| echo: false

tier_summary <- scored_parcels |>
  mutate(
    # Combine size-restricted categories
    development_category = case_when(
      development_potential %in% c("Small Parcel", "Too Large") ~ "Size-Restricted",
      TRUE ~ development_potential
    )
  ) |>
  count(development_category) |>
  mutate(
    pct = n / sum(n) * 100,
    label = paste0(n, " (", round(pct, 0), "%)"),
    potential_order = factor(development_category, 
                             levels = c("High", "Moderate", "Size-Restricted", "Constrained"))
  ) |>
  arrange(potential_order)

ggplot(tier_summary, aes(x = "", y = n, fill = potential_order)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", fontface = "bold", size = 4) +
  scale_fill_manual(
    values = c(
      "High" = "#445ca9",
      "Moderate" = "#8baeaa",
      "Size-Restricted" = "#e76f52",
      "Constrained" = "#e9ab3f"
    )
  ) +
  labs(fill = "Development Potential") +
  theme_void(base_size = 12) +
  theme(
    legend.position = "bottom"
  ) +
  guides(fill = guide_legend(nrow = 1))
```

## Property Size vs Development Score

```{r}
#| label: fig-size-vs-score
#| fig-cap: "Development Scores by Property Size Category"
#| fig-height: 4
#| echo: false

scored_parcels |>
  mutate(
    size_category = case_when(
      area_acres < 0.5 ~ "< 0.5 acres (Too Small)",
      area_acres < 1.5 ~ "0.5–1.5 acres (Moderate)",
      area_acres <= 5 ~ "1.5–5 acres (High)",
      area_acres <= 10 ~ "5–10 acres (Too Large)",
      TRUE ~ "10+ acres (Too Large)"
    ),
    size_category = factor(size_category, 
                           levels = c("< 0.5 acres (Too Small)", 
                                      "0.5–1.5 acres (Moderate)", 
                                      "1.5–5 acres (High)", 
                                      "5–10 acres (Too Large)", 
                                      "10+ acres (Too Large)")),
    # Combine size-restricted categories
    development_category = case_when(
      development_potential %in% c("Small Parcel", "Too Large") ~ "Size-Restricted",
      TRUE ~ development_potential
    ),
    development_category = factor(development_category,
                                   levels = c("High", "Moderate", "Size-Restricted", "Constrained"))
  ) |>
  ggplot(aes(x = size_category, y = development_score, color = development_category)) +
  geom_jitter(width = 0.2, alpha = 0.7, size = 3) +
  scale_color_manual(
    values = c(
      "High" = "#445ca9",
      "Moderate" = "#8baeaa",
      "Size-Restricted" = "#e76f52",
      "Constrained" = "#e9ab3f"
    )
  ) +
  labs(
    x = "Parcel Size Category",
    y = "Development Score",
    color = "Development Potential"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.major.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1, size = 10)
  ) +
  guides(color = guide_legend(nrow = 1))
```

The most high and moderate-potential properties concentrate in the 0.5–5 acre "sweet spot," while parcels under 0.5 acre face inherent limitations and the largest sites show more constraints. 

## Summary Metrics

### By County

#### Geographic Distribution: Understanding Two Complementary Metrics

The portfolio spans multiple counties with highly variable concentration and development potential. Understanding the distribution requires recognizing how two distinct metrics work together:
"High Potential" Classification (categorical): Properties meeting physical criteria—1.5-5 acres, minimal environmental constraints, documented land value. This measures what's physically developable.
Development Score (0-100 numerical): Weighted assessment across six factors—size (20%), current use (25%), location (20%), financial need (15%), market potential (10%), and zoning (10%), minus constraint penalties. This measures how attractive development would be.
These metrics can diverge significantly, revealing different types of opportunities and challenges:

**Tier 1: Premium Opportunities (High Scores + High Potential)**
Frederick County (Winchester): The portfolio's standout performer

Albemarle & Fairfax Counties: Strong individual opportunities

These counties offer proven development candidates with favorable market conditions offsetting some regulatory complexity (historic districts in several cases)


**Tier 2: Volume Opportunities (High Potential Count, Modest Scores)**
Fauquier County: The geographic concentration story

The divergence tells the story: These properties have the right physical characteristics (good acreage, unconstrained) but face market and location limitations (rural setting, lower walkability scores, modest income growth)

Portfolio-scale development approach: multiple properties here could support coordinated affordable housing or creative mixed-use projects with patient capital

Fairfax-City: Urban properties with modest outcomes

The moderate scores despite good market fundamentals suggest regulatory complexity (likely historic districts) or current use challenges (active church buildings rather than parking lots) These would require sophisticated partners comfortable with urban regulatory environments.


**Tier 3: The King William Challenge (High Volume, Low Potential)**
King William County: The inverse of Fauquier

Contains 18% of all portfolio parcels but contributes zero development opportunities
Why the divergence? These properties fail the physical threshold: likely dominated by small parcels under 0.5 acres (including the 11 properties requiring geocoding) and possibly some oversized parcels above 5 acres

This represents legacy holdings—land accumulated through historical donations and gifts that don't align with modern development economics. Consider disposition, conservation easements, or alternative mission uses (community gardens, land banks) rather than pursuing development


**Tier 4: Limited Engagement Counties**
Richmond, Fluvanna, and others: Single properties with mixed potential

These counties offer opportunistic development where individual properties merit attention but don't justify significant resource concentration. Evaluate individually as opportunities arise; don't force development


#### Key Strategic Insights:
1. Geographic concentration matters differently than expected

King William's 19 properties don't equal opportunity—they equal legacy management challenge
Fauquier's 4 High Potential properties in one county enable economies of scale in development planning, partner recruitment, and regulatory engagement

2. The metrics reveal different barriers

High Potential count = physical development capacity (do we have the right-sized land?)
Average score = market/location/use factors (will development actually work here?)
Counties with high counts but low scores (Fauquier) need creative approaches to overcome market limitations
Counties with zero high potential (King William) face fundamental size constraints no amount of market improvement can fix

3. Resource allocation follows quality, not quantity

Frederick County (2 parcels) deserves more attention than King William County (19 parcels)
Focus development capital on Fauquier's 4 properties as a coordinated portfolio rather than spreading resources across single properties in 10 different counties

4. Multiple parcels ≠ multiple opportunities

Many parcels serve single congregations (particularly in King William)
The 104 total parcels overstate discrete development sites—true opportunity count is closer to 39 goldilocks properties across fewer than 20 congregational sites

*Note: "High Potential" indicates properties meeting size criteria (1.5-5 acres) and minimal constraints. Average Score reflects broader market and location factors. Counties with high counts but lower scores have developable land facing market or location challenges.*

**Bottom Line:** The Diocese should pursue an uneven geographic strategy that concentrates development resources in Frederick/Winchester (flagship quality), Fauquier (portfolio scale), and select Albemarle/Fairfax opportunities (proven viability), while being realistic that high-volume counties like King William represent asset management challenges, not development opportunities.

### High Potential

```{r}
#| label: tbl-high-potential
#| tbl-cap: "Top Development Potential Properties"
#| echo: false

library(kableExtra)

high_potential_props <- property_profile |>
  filter(development_potential %in% c("High")) |>
  arrange(desc(development_score)) |>
  slice_head(n = 10)

if(nrow(high_potential_props) > 0) {
  high_potential_props |>
    mutate(Rank = row_number()) |>
    select(Rank, sadd, scity, scounty, rgisacre, development_score, development_potential) |>
    kable(
      col.names = c("Rank", "Address", "City", "County", "Acres", "Score", "Tier"),
      digits = c(0, 0, 0, 0, 2, 1, 0),
      align = c("c", "l", "l", "l", "r", "r", "l")
    ) |>
    kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
    row_spec(0, bold = TRUE, background = "#445ca9", color = "white") |>
    row_spec(1:min(5, nrow(high_potential_props)), bold = TRUE)
} else {
  cat("No properties currently meet the High or Moderate development potential criteria.")
}
```

## Congregation Health Indicators

```{r}
#| label: fig-attendance-pledge
#| fig-cap: "Congregation Health and Financial Need"
#| fig-height: 5
#| echo: false 

plot_data <- property_profile |>
  filter(!is.na(avg_attendance), !is.na(avg_pledge), 
         avg_attendance > 0, avg_pledge > 0) |>
  distinct(congregation_name, .keep_all = TRUE) |>
  mutate(
    financial_status = case_when(
      financial_need >= 2 ~ "Financial Need",
      TRUE ~ "Stable"
    )
  )

need_count <- sum(plot_data$financial_status == "Financial Need")
stable_count <- sum(plot_data$financial_status == "Stable")

ggplot(plot_data, aes(x = avg_attendance, y = avg_pledge / 1000, 
                      color = financial_status, shape = financial_status)) +
  geom_point(alpha = 0.7, size = 3) +
  scale_color_manual(values = c("Financial Need" = "#e76f52", "Stable" = "#445ca9")) +
  scale_shape_manual(values = c("Financial Need" = 17, "Stable" = 16)) +
  scale_x_log10() +
  scale_y_log10(labels = scales::dollar_format(suffix = "K")) +
  annotate("text", x = 10, y = 200, 
           label = paste0("Financial Need: ", need_count, " congregations"), 
           color = "#e76f52", fontface = "bold", hjust = 0, size = 3.5) +
  annotate("text", x = 10, y = 120, 
           label = paste0("Stable: ", stable_count, " congregations"), 
           color = "#445ca9", fontface = "bold", hjust = 0, size = 3.5) +
  labs(
    x = "Average Sunday Attendance",
    y = "Annual Plate & Pledge ($K)",
    color = "", shape = ""
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```
::: {.callout-note}
## Understanding Financial Need

Congregations flagged as 'Financial Need' may still report substantial annual giving, but their attendance and/or pledge revenue have declined significantly since 2014. These congregations are not in crisis today—but without intervention, they face an unsustainable path. Development partnerships offer an opportunity to stabilize finances while congregations remain viable, rather than waiting until resources are exhausted.
:::

```{r}
#| echo: false

property_profile |>
  filter(financial_need >= 2, avg_pledge > 50000) |>
  distinct(congregation_name, .keep_all = TRUE) |>
  select(congregation_name, avg_attendance, avg_pledge, pct_change_attendance, pct_change_pledge) |>
  arrange(pct_change_attendance) |>
  mutate(
    avg_pledge = scales::dollar(avg_pledge),
    pct_change_attendance = paste0(round(pct_change_attendance, 1), "%"),
    pct_change_pledge = paste0(round(pct_change_pledge, 1), "%")
  ) |>
  kable(
    col.names = c("Congregation", "Avg Attendance", "Avg Pledge", "Attendance Change", "Pledge Change"),
    align = c("l", "r", "r", "r", "r")
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
  row_spec(0, bold = TRUE, background = "#445ca9", color = "white")
```
These congregations show the largest declines in attendance and pledge over recent years.
