---
title: "VEREP Property Development Analysis"
subtitle: "Strategic Assessment of Development Opportunities"
author: "HDAdvisors"
date: today
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-summary: "Show code"
    embed-resources: true
    theme: cosmo
    number-sections: false
  pptx:
    slide-level: 2
    incremental: false
  pdf:
    toc: true
    toc-depth: 3
    geometry:
      - margin=1in
    mainfont: "Lato"
    sansfont: "Lato"
execute:
  warning: false
  message: false
  echo: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(fmsb)
library(scales)
library(sf)
library(kableExtra)

knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 10,
  fig.height = 6
)
```

```{css}
#| echo: false
#| content-visible: when-format="html"

@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Lato:wght@300;400;700&display=swap');

body {
  font-family: 'Lato', sans-serif;
  color: #333333;
  line-height: 1.6;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Roboto Slab', serif;
  color: #445ca9;
  margin-top: 1.5em;
}

h1 {
  border-bottom: 3px solid #445ca9;
  padding-bottom: 0.5em;
}

h2 {
  border-bottom: 2px solid #8baeaa;
  padding-bottom: 0.3em;
}

.callout-note {
  border-left-color: #445ca9 !important;
  background-color: #f8f9fa;
}

.callout-warning {
  border-left-color: #e76f52 !important;
}

.callout-tip {
  border-left-color: #8baeaa !important;
}

.callout-important {
  border-left-color: #e9ab3f !important;
}

a {
  color: #445ca9;
}

a:hover {
  color: #e9ab3f;
}

.stat-box {
  background: linear-gradient(135deg, #445ca9 0%, #8baeaa 100%);
  color: white;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  margin: 10px;
}

.stat-number {
  font-size: 2.5em;
  font-weight: bold;
  font-family: 'Roboto Slab', serif;
}

.stat-label {
  font-size: 0.9em;
  text-transform: uppercase;
  letter-spacing: 1px;
}
```

```{r load-data, include=FALSE}
# Load VEREP parcel data
parcels_raw <- read_csv("data/verep040725.csv")

# Load congregation statistics
congregations_raw <- read_csv("data/congregation.csv")
```

```{r process-congregations, include=FALSE}
# Calculate key metrics for each congregation
congregations <- congregations_raw %>%
  mutate(
    # Calculate percent changes from 2014 to 2023
    pct_change_attendance = ((f2023_sunday_attendance - f2014_sunday_attendance) / 
                              f2014_sunday_attendance) * 100,
    pct_change_members = ((f2023_members_this_year - f2014_members_this_year) / 
                           f2014_members_this_year) * 100,
    pct_change_pledge = ((f2023_plate_and_pledge - f2014_plate_and_pledge) / 
                          f2014_plate_and_pledge) * 100,
    
    # Average values across all years
    avg_attendance = attendance_avg,
    avg_members = member_avg,
    avg_pledge = platepledge_avg,
    
    # Financial health indicator (declining = higher score for development need)
    financial_need = case_when(
      pct_change_pledge < -20 ~ 3,  # High need
      pct_change_pledge < 0 ~ 2,    # Moderate need
      pct_change_pledge < 10 ~ 1,   # Low need
      TRUE ~ 0                      # No need
    ),
    
    # Congregation size category
    size_category = case_when(
      avg_attendance < 25 ~ "Very Small",
      avg_attendance < 50 ~ "Small",
      avg_attendance < 100 ~ "Medium",
      avg_attendance < 200 ~ "Large",
      TRUE ~ "Very Large"
    )
  ) %>%
  # Handle missing values
  mutate(across(starts_with("pct_change"), ~replace_na(., 0)),
         across(starts_with("avg_"), ~replace_na(., 0)))
```

```{r process-parcels, include=FALSE}
# Clean and prepare parcel data
df <- parcels_raw %>%
  # Convert key fields
  mutate(
    # Calculate acres from square feet if needed
    area_acres = case_when(
      !is.na(rgisacre) ~ rgisacre,
      !is.na(rgissqft) ~ rgissqft / 43560,
      !is.na(deed_acres) ~ deed_acres,
      TRUE ~ NA_real_
    ),
    
    # Clean use flags (convert to logical)
    use_church = church == 1,
    use_cemetery = cemetery == 1,
    use_school = school == 1,
    use_parking = parking == 1,
    use_open_space = open_space == 1,
    use_residence = residence == 1,
    
    # Clean constraint fields
    flood_zone = case_when(
      is.na(fema_fz) | fema_fz == "X" ~ "None",
      TRUE ~ fema_fz
    ),
    
    wetlands_pct = replace_na(wet_perc, 0),
    
    has_easement = !is.na(easement) & easement != "",
    
    in_historic_district = !is.na(hist_dist) & hist_dist != "",
    
    # Location quality metrics
    walkability_score = replace_na(walk_idx, 0),
    
    transit_access_score = case_when(
      trans_acc >= 3 ~ 100,
      trans_acc == 2 ~ 60,
      trans_acc == 1 ~ 30,
      TRUE ~ 0
    ),
    
    # Zoning favorability (simplified)
    zoning_favorable = case_when(
      str_detect(zon_desc, regex("mixed|commercial|residential", ignore_case = TRUE)) ~ TRUE,
      TRUE ~ FALSE
    ),
    
    # Market indicators
    median_income = medinc,
    poverty_rate = pov_prc,
    
    # QCT flag for LIHTC incentives
    qualified_census_tract = !is.na(qct) & qct != 0,
    
    # Clean building year
    year_built = case_when(
      yr_blt_num > 1700 & yr_blt_num < 2025 ~ yr_blt_num,
      TRUE ~ NA_real_
    ),
    
    # Assessed value
    assessed_value = par_val,
    
    # Site characteristics
    site_address = sadd,
    site_city = scity,
    site_county = scounty
  ) %>%
  # Filter to properties with minimum data quality
  filter(
    !is.na(area_acres),
    area_acres > 0.1,
    !is.na(lat) & !is.na(lon)
  )
```

```{r join-data, include=FALSE}
# Join congregation data to parcels
df_joined <- df %>%
  left_join(
    congregations %>% select(
      name, short_name,
      pct_change_attendance, pct_change_members, pct_change_pledge,
      avg_attendance, avg_members, avg_pledge,
      financial_need, size_category
    ),
    by = c("congr_name" = "short_name")
  ) %>%
  mutate(
    has_congregation = !is.na(name),
    
    pct_change_pledge = case_when(
      !has_congregation & use_church ~ 0,
      TRUE ~ pct_change_pledge
    ),
    
    financial_need = case_when(
      !has_congregation & use_church ~ 1,
      TRUE ~ financial_need
    )
  )
```

```{r calculate-scores, include=FALSE}
scored_parcels <- df_joined %>%
  mutate(
    # 1. SIZE SCORE (0-100)
    size_score = case_when(
      area_acres < 0.25 ~ 20,
      area_acres < 0.5 ~ 50,
      area_acres < 1 ~ 70,
      area_acres < 2 ~ 90,
      area_acres < 5 ~ 100,
      area_acres < 10 ~ 85,
      TRUE ~ 70
    ),
    
    # 2. USE TYPE SCORE (0-100)
    use_score = case_when(
      use_parking ~ 95,
      use_open_space ~ 90,
      use_cemetery ~ 5,
      use_church & !use_parking & !use_open_space ~ 30,
      use_residence ~ 40,
      use_school ~ 35,
      TRUE ~ 60
    ),
    
    # 3. LOCATION SCORE (0-100)
    location_score = (
      (walkability_score / max(walkability_score, na.rm = TRUE) * 60) +
      (transit_access_score * 0.4)
    ),
    location_score = pmin(100, pmax(0, location_score)),
    
    # 4. FINANCIAL NEED SCORE (0-100)
    financial_score = case_when(
      is.na(financial_need) ~ 30,
      financial_need == 3 ~ 100,
      financial_need == 2 ~ 70,
      financial_need == 1 ~ 40,
      TRUE ~ 20
    ),
    
    # 5. MARKET POTENTIAL SCORE (0-100)
    market_score = case_when(
      is.na(median_income) ~ 50,
      median_income > 100000 ~ 90,
      median_income > 75000 ~ 75,
      median_income > 50000 ~ 60,
      TRUE ~ 40
    ),
    
    market_score = if_else(qualified_census_tract, market_score + 15, market_score),
    market_score = pmin(100, market_score),
    
    # 6. ZONING SCORE (0-100)
    zoning_score = if_else(zoning_favorable, 80, 40),
    
    # 7. CONSTRAINT PENALTIES
    constraint_penalty = case_when(
      flood_zone != "None" ~ -40,
      wetlands_pct > 25 ~ -35,
      has_easement ~ -30,
      in_historic_district ~ -25,
      wetlands_pct > 10 ~ -20,
      TRUE ~ 0
    ),
    
    # COMPOSITE DEVELOPMENT SCORE
    development_score = (
      (size_score * 0.20) +
      (use_score * 0.25) +
      (location_score * 0.20) +
      (financial_score * 0.15) +
      (market_score * 0.10) +
      (zoning_score * 0.10)
    ) + constraint_penalty,
    
    development_score = pmin(100, pmax(0, development_score)),
    
    # Create development tier
    development_tier = case_when(
      development_score >= 75 ~ "Tier 1: High Priority",
      development_score >= 60 ~ "Tier 2: Strong Potential",
      development_score >= 45 ~ "Tier 3: Moderate Potential",
      development_score >= 30 ~ "Tier 4: Limited Potential",
      TRUE ~ "Tier 5: Not Recommended"
    )
  )
```

```{r identify-top-10, include=FALSE}
# Get top 10 developable properties
top_10 <- scored_parcels %>%
  arrange(desc(development_score)) %>%
  slice_head(n = 10) %>%
  mutate(rank = row_number()) %>%
  select(
    rank, objectid, site_address, site_city, site_county,
    area_acres, development_score, development_tier,
    use_church, use_parking, use_open_space,
    walkability_score, financial_need,
    congr_name, name, avg_attendance, pct_change_pledge,
    lat, lon
  )
```

# Executive Summary {.unnumbered}

::: {.content-visible when-format="html"}
This analysis examines properties of interest (defined in methodology) with fewer than 30 Sunday attendees, focusing on development potential through five key metrics: land value, zoning/density, acreage, environmental limitations, and Qualified Census Tract (QCT) status.

::: {.callout-important}
## Key Findings

This analysis evaluated **`r nrow(scored_parcels)`** properties across the diocese to identify optimal development opportunities. Using a comprehensive scoring methodology, we identified **10 high-priority properties** representing **`r round(sum(top_10$area_acres), 1)` total acres** with significant development potential.

**Top Insights:**
- **`r sum(scored_parcels$development_score >= 60)`** properties score in Tier 1-2 (strong development potential)
- **Primary opportunities:** Underutilized parking lots and open space
- **Average parcel size:** `r round(mean(df$area_acres, na.rm = TRUE), 2)` acres
- **Congregations with declining pledges:** `r sum(top_10$financial_need >= 2, na.rm = TRUE)` properties show high financial need
:::

::: {layout-ncol=4}
::: {.stat-box}
::: {.stat-number}
`r nrow(scored_parcels)`
:::
::: {.stat-label}
Properties Analyzed
:::
:::

::: {.stat-box}
::: {.stat-number}
10
:::
::: {.stat-label}
High Priority Sites
:::
:::

::: {.stat-box}
::: {.stat-number}
`r round(sum(top_10$area_acres), 1)`
:::
::: {.stat-label}
Developable Acres
:::
:::

::: {.stat-box}
::: {.stat-number}
`r sum(top_10$financial_need >= 2, na.rm = TRUE)`
:::
::: {.stat-label}
Financial Need
:::
:::
:::
:::

::: {.content-visible when-format="pptx"}
## Strategic Overview

**Portfolio Analysis:**

- **`r nrow(scored_parcels)` properties** analyzed across diocese
- **`r sum(scored_parcels$development_score >= 60)` properties** with strong potential (Tier 1-2)
- **`r round(sum(top_10$area_acres), 1)` acres** in top 10 opportunities
- **`r sum(top_10$financial_need >= 2, na.rm = TRUE)` congregations** with high financial need
:::

---

## At a Glance: Top 10 Properties

::: {.content-visible when-format="html"}
```{r top-10-summary-table}
top_10 %>%
  select(rank, site_address, site_city, area_acres, development_score, development_tier) %>%
  kable(
    col.names = c("Rank", "Property Address", "City", "Acres", "Score", "Tier"),
    digits = 1,
    align = c("c", "l", "l", "r", "r", "l")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center"
  ) %>%
  column_spec(1, bold = TRUE, color = "white", background = "#445ca9") %>%
  column_spec(5, bold = TRUE, color = "#445ca9") %>%
  row_spec(1:3, background = "#f8f9fa")
```
:::

::: {.content-visible when-format="pptx"}
```{r top-10-summary-table-pptx}
top_10 %>%
  select(rank, site_address, site_city, area_acres, development_score) %>%
  kable(
    col.names = c("Rank", "Address", "City", "Acres", "Score"),
    digits = 1
  )
```
:::

---

# Key Findings

::: {.content-visible when-format="pptx"}
## Significant Underutilized Assets

**87 properties** score in Tier 1-2 with strong development potential

**Primary Opportunities:**

- Parking lots (highest scores)
- Open space parcels
- Properties with declining congregations

**Development Benefits:**

- Long-term ground lease revenue
- Financial stability for congregations
- Mission-aligned affordable housing
:::

::: {.content-hidden when-format="pptx"}
## Significant Underutilized Assets

**87 properties** score in Tier 1-2 (strong development potential), representing substantial untapped value across the diocese. Primary opportunities exist in:

- **Parking lots** (highest development scores): Structured parking with mixed-use above
- **Open space parcels**: Well-located vacant land ideal for ground lease arrangements
- **Properties with declining congregations**: Sites where development can provide financial stability

## Geographic Distribution

Development opportunities are distributed across Virginia, with concentrations in:
- Urban/suburban areas with strong walkability scores
- Markets with favorable demographics and LIHTC eligibility
- Transit-accessible locations supporting reduced parking requirements

## Financial Sustainability Imperative

**`r sum(top_10$financial_need >= 2, na.rm = TRUE)` of the top 10 properties** are associated with congregations showing significant financial decline (pledge revenue down 20%+ over past decade). Strategic development can provide:

- Long-term ground lease revenue
- Capital for building improvements
- Sustainable financial model for congregation vitality
:::

---

# Methodology & Data

::: {.content-visible when-format="pptx"}
## Data Sources

**VEREP Parcel Dataset (CGS Consultants):**

- `r nrow(parcels_raw)` parcels across Virginia
- Property characteristics, zoning, environmental data

**Congregation Statistics (2014-2023):**

- Attendance and membership trends
- Financial health indicators
:::

::: {.content-hidden when-format="pptx"}
## Background & Data Sources

### VEREP Parcel Dataset
This analysis utilizes the Virginia Episcopal Real Estate Portfolio (VEREP) parcel dataset, compiled by CGS Consultants. The dataset includes:

- **`r nrow(parcels_raw)` parcels** across Virginia
- Comprehensive property characteristics (size, use, zoning)
- Environmental constraints (floodplains, wetlands, easements)
- Location metrics (walkability, transit access)
- Market indicators (median income, demographics)

### Congregation Statistics (2014-2023)
Financial and membership data provides context on congregation health:

- Sunday attendance trends
- Membership changes
- Plate & pledge revenue
- 10-year trend analysis

::: {.callout-note}
## Data Quality Note
Not all properties have associated congregation data. Properties without congregation information received neutral scores in the financial need category.
:::
:::

---

::: {.content-visible when-format="pptx"}
## Scoring Framework

```{r scoring-visual-pptx, fig.height=4.5}
scoring_components <- tibble(
  Component = c("Current Use", "Property Size", "Location", 
                "Financial Need", "Market", "Zoning"),
  Weight = c(25, 20, 20, 15, 10, 10)
)

ggplot(scoring_components, aes(x = reorder(Component, Weight), y = Weight)) +
  geom_col(fill = "#445ca9", alpha = 0.8) +
  geom_text(aes(label = paste0(Weight, "%")), hjust = -0.2, 
            size = 5, color = "#445ca9", fontface = "bold") +
  coord_flip() +
  scale_y_continuous(limits = c(0, 30)) +
  labs(title = "Six Weighted Dimensions", x = "", y = "Weight (%)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = "#445ca9"),
    panel.grid.major.y = element_blank()
  )
```
:::

::: {.content-hidden when-format="pptx"}
## Analytical Framework

### Development Potential Scoring

Our methodology evaluates six key dimensions:

```{r scoring-visual, fig.height=4}
scoring_components <- tibble(
  Component = c("Property Size", "Current Use", "Location Quality", 
                "Financial Need", "Market Potential", "Zoning"),
  Weight = c(20, 25, 20, 15, 10, 10),
  Description = c(
    "Optimal size for development (0.5-5 acres scores highest)",
    "Underutilized properties (parking lots, open space)",
    "Walkability and transit accessibility",
    "Congregation financial health trends",
    "Area income levels and LIHTC eligibility",
    "Development-friendly zoning classifications"
  )
)

ggplot(scoring_components, aes(x = reorder(Component, Weight), y = Weight)) +
  geom_col(fill = "#445ca9", alpha = 0.8) +
  geom_text(aes(label = paste0(Weight, "%")), hjust = -0.2, size = 5, 
            color = "#445ca9", fontface = "bold") +
  coord_flip() +
  scale_y_continuous(limits = c(0, 30)) +
  labs(
    title = "Development Score Components",
    subtitle = "Weighted contribution to final score",
    x = "",
    y = "Weight (%)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = "#445ca9"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )
```

**Constraint Penalties:** Properties receive deductions for flood zones (-40), significant wetlands (-35), easements (-30), and historic district designation (-25).
:::

---

::: {.content-visible when-format="pptx"}
## Development Tiers

| Tier | Score | Description |
|------|-------|-------------|
| **Tier 1** | 75-100 | High Priority - Immediate candidates |
| **Tier 2** | 60-74 | Strong Potential - Near-term |
| **Tier 3** | 45-59 | Moderate - Creative solutions |
| **Tier 4** | 30-44 | Limited - Significant barriers |
| **Tier 5** | <30 | Not Recommended |
:::

::: {.content-hidden when-format="pptx"}
### Development Tiers

Properties are classified into five tiers based on composite scores:

- **Tier 1 (75-100):** High Priority - Immediate development candidates
- **Tier 2 (60-74):** Strong Potential - Near-term opportunities
- **Tier 3 (45-59):** Moderate Potential - Requires creative solutions
- **Tier 4 (30-44):** Limited Potential - Significant barriers exist
- **Tier 5 (<30):** Not Recommended - Unsuitable for development
:::

---

## Understanding the Development Criteria

### Why These Factors Matter

Our scoring methodology reflects decades of real estate development experience and incorporates both market realities and mission-aligned priorities. Each criterion was selected to balance financial viability with community impact, ensuring that recommended properties can support sustainable development while serving congregational needs.

#### Property Size: The Goldilocks Principle

**Optimal Range: 0.5-5 acres**

Property size significantly influences development feasibility, but bigger isn't always better. Properties under a quarter-acre typically lack the critical mass needed for financially viable developmentâ€”construction costs per unit rise sharply, and parking or open space requirements become impossible to meet. Conversely, parcels exceeding 10 acres often present unique challenges: they may require complex phasing, demand substantial upfront capital, or face community resistance to density.

The "sweet spot" of 0.5-5 acres aligns with typical mixed-use development projects. A half-acre can accommodate a modest 20-30 unit building with ground-floor retail or community space. Two to three acres enables more ambitious projectsâ€”perhaps 75-100 residential units, structured parking, and meaningful ground-floor activation. Properties in this range also match the investment thresholds of most community development corporations and mission-driven developers who are natural partners for faith-based institutions.

#### Current Use: Identifying Low-Hanging Fruit

**Highest Potential: Parking Lots and Open Space**

Not all church property serves its highest and best use. Surface parking lots represent prime redevelopment opportunitiesâ€”they're already cleared and graded, typically have minimal environmental constraints, and often sit underutilized six days per week. A parking lot that serves 200 congregants on Sunday morning but stands empty Monday through Saturday represents an enormous opportunity cost.

Open space scores similarly high, particularly when it's amenity-free lawn rather than programmed recreation or memorial gardens. These properties can be reimagined while potentially retaining some green space within new development.

Conversely, active church buildings score lower not because development is impossible, but because it's complex. Any project must navigate active programming, potential relocation needs, and the emotional attachment congregations feel toward sacred spaces. Cemeteries score lowestâ€”they're essentially undevelopable under most state laws and carry profound cultural sensitivities.

#### Location Quality: Following the Market

**Key Metrics: Walkability Score and Transit Access**

Real estate development fundamentally responds to location. A walkable, transit-rich site commands higher rents, attracts more diverse tenants, and often qualifies for density bonuses or reduced parking requirementsâ€”all factors that improve project economics.

Walkability scores measure proximity to everyday needs: grocery stores, schools, employment centers, healthcare. High walkability (15-20 on our scale) indicates a property can support car-light or car-free households, expanding the potential tenant base to include young professionals, seniors aging in place, and lower-income families for whom car ownership is cost-prohibitive.

Transit access amplifies these benefits. Properties within a quarter-mile of frequent bus service or half-mile of rail stations can often negotiate reduced parking requirements with municipalitiesâ€”a significant cost savings when structured parking runs $25,000-$40,000 per space to construct.

#### Financial Need: Aligning Development with Mission

**Priority: Congregations with Declining Resources**

This criterion explicitly centers mission over pure market return. Congregations experiencing sustained pledge declines often face a difficult reality: their historic buildings demand expensive maintenance, but shrinking budgets make upkeep increasingly burdensome. Many such congregations sit on valuable real estate that could, through thoughtful development, generate steady income streams while maintaining their worship and ministry.

A ground lease arrangement, for example, might provide a struggling congregation with $50,000-$150,000 annually in stable incomeâ€”enough to fund a part-time rector, maintain the building, and sustain core ministries. This approach transforms real estate from a drain on resources into a mission enabler.

Properties associated with growing congregations score lower not because they lack development potential, but because the urgency is less acute. These communities likely have more options and less immediate financial pressure.

#### Market Potential: Reading Economic Signals

**Indicator: Area Median Income and LIHTC Eligibility**

Development must respond to market demand. Properties in higher-income areas (median incomes above $75,000) typically support market-rate housing, ground-floor retail, or mixed-use projects that can cross-subsidize affordable components. These projects attract conventional financing and a broader range of development partners.

Properties in Qualified Census Tracts (QCTs) gain additional scoring weight because they unlock Low-Income Housing Tax Credit (LIHTC) financingâ€”the nation's primary mechanism for affordable housing production. LIHTC projects in QCTs receive point advantages in competitive funding rounds, improving their feasibility. For mission-driven institutions committed to affordable housing, QCT properties offer a rare alignment of social impact and financial viability.

#### Zoning: Navigating Regulatory Reality

**Favorable: Mixed-Use, Commercial, and Residential Districts**

Zoning powerfully shapes what's buildable and how quickly projects move from concept to construction. Properties zoned for residential or mixed-use development typically offer by-right development opportunitiesâ€”projects that don't require lengthy rezoning processes, conditional use permits, or special exceptions.

Conversely, properties in restrictive single-family or conservation districts may require multi-year regulatory processes, neighborhood opposition, and uncertain outcomes. While such projects occasionally succeed, they demand patient capital and sophisticated development partners.

#### Environmental and Regulatory Constraints: Deal-Breakers vs. Speed-Bumps

**Critical: Flood Zones, Wetlands, Easements, Historic Districts**

These constraints receive substantial score penalties because they materially affect project feasibility and cost. Properties in 100-year floodplains face expensive flood insurance, elevated construction costs, and increasingly cautious lenders post-climate-change. Development in such areas may be technically possible but financially marginal.

Significant wetlands (>25% of parcel) trigger federal and state permitting, potential mitigation requirements, and uncertainty about buildable area. Easementsâ€”particularly those held by third partiesâ€”can restrict development rights, limit building envelopes, or prevent property subdivision.

Historic district designation doesn't prohibit development but adds layers of design review, material requirements, and timeline uncertainty. Some historic commissions embrace creative contemporary additions; others mandate strict historicism that may conflict with modern construction economics.

---

### Bringing It All Together

These six criteria, combined with constraint penalties, create a holistic picture of development potential. A property might score exceptionally well on size and location but face significant challenges from environmental constraints. Another might have modest physical attributes but represent an urgent opportunity to support a financially stressed congregation.

The weighted scoring system allows us to compare apples to orangesâ€”to evaluate whether a small, perfectly-located property in a historic district outweighs a larger, unrestricted site with less market demand. This methodology doesn't make decisions for stakeholders but rather creates a common language for discussing trade-offs and priorities.

Ultimately, successful church real estate development requires more than high scores. It demands patient capital, mission-aligned partners, engaged congregations, and creative design. But by systematically evaluating these criteria, we can identify the properties where stars alignâ€”where market demand, congregational need, and regulatory environment converge to create genuine opportunity.


# Analysis Results

## Development Opportunity Landscape

```{r tier-distribution-visual}
tier_data <- scored_parcels %>%
  count(development_tier) %>%
  mutate(
    pct = n / sum(n) * 100,
    tier_order = case_when(
      str_detect(development_tier, "Tier 1") ~ 1,
      str_detect(development_tier, "Tier 2") ~ 2,
      str_detect(development_tier, "Tier 3") ~ 3,
      str_detect(development_tier, "Tier 4") ~ 4,
      TRUE ~ 5
    ),
    color = case_when(
      tier_order == 1 ~ "#445ca9",
      tier_order == 2 ~ "#8baeaa",
      tier_order == 3 ~ "#e9ab3f",
      tier_order == 4 ~ "#e76f52",
      TRUE ~ "#cccccc"
    )
  ) %>%
  arrange(tier_order)

ggplot(tier_data, aes(x = reorder(development_tier, -tier_order), y = n, fill = color)) +
  geom_col() +
  geom_text(aes(label = paste0(n, "\n(", round(pct, 1), "%)")), 
            vjust = 1.5, color = "white", size = 4, fontface = "bold") +
  scale_fill_identity() +
  labs(
    title = "Distribution of Properties by Development Tier",
    subtitle = paste0("Total Properties Analyzed: ", sum(tier_data$n)),
    x = "",
    y = "Number of Properties"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = "#445ca9"),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    panel.grid.major.x = element_blank()
  )
```

---

## Geographic Distribution

::: {.content-visible when-format="html"}
```{r top-10-map-html}
# Interactive leaflet map
pal <- colorNumeric(
  palette = "YlOrRd",
  domain = top_10$development_score
)

leaflet(top_10) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(
    lng = ~lon,
    lat = ~lat,
    radius = ~sqrt(area_acres) * 5,
    fillColor = ~pal(development_score),
    fillOpacity = 0.8,
    color = "white",
    weight = 2,
    popup = ~paste0(
      "<div style='font-family: Lato, sans-serif; min-width: 250px;'>",
      "<h4 style='color: #445ca9; margin-bottom: 10px;'>Rank #", rank, "</h4>",
      "<p style='margin: 5px 0;'><b>", site_address, "</b><br>",
      site_city, ", ", site_county, " County</p>",
      "<hr style='margin: 10px 0;'>",
      "<p style='margin: 5px 0;'><b>Development Score:</b> ", round(development_score, 1), "/100<br>",
      "<b>Size:</b> ", round(area_acres, 2), " acres<br>",
      "<b>Tier:</b> ", development_tier, "</p>",
      if_else(!is.na(name), 
              paste0("<hr style='margin: 10px 0;'><p style='margin: 5px 0;'><b>Congregation:</b> ", name, "</p>"), 
              ""),
      "</div>"
    ),
    label = ~paste0("#", rank, ": ", site_address)
  ) %>%
  addLegend(
    position = "bottomright",
    pal = pal,
    values = ~development_score,
    title = "Development<br>Score",
    opacity = 1
  ) %>%
  setView(lng = mean(top_10$lon), lat = mean(top_10$lat), zoom = 7)
```
:::

::: {.content-visible when-format="pptx"}
```{r static-map-pptx}
# Static map for PowerPoint
ggplot(top_10, aes(x = lon, y = lat)) +
  geom_point(aes(size = area_acres, color = development_score), alpha = 0.7) +
  scale_color_gradient(low = "yellow", high = "red", name = "Score") +
  scale_size_continuous(range = c(3, 10), name = "Acres") +
  labs(title = "Top 10 Development Sites", x = "Longitude", y = "Latitude") +
  theme_minimal()
```
:::

---

::: {.content-hidden when-format="pptx"}
# Summary Statistics

## Property Portfolio Overview

### Ownership Distribution
```{r ownership-breakdown-calc, include=FALSE}
# Breakdown by ownership type
ownership_stats <- scored_parcels %>%
  mutate(
    ownership_type = case_when(
      str_detect(tolower(v_owntype), "diocese") ~ "Diocese-Owned",
      str_detect(tolower(v_owntype), "congregation") ~ "Congregation-Owned",
      str_detect(tolower(v_owntype), "related") ~ "Related Organization",
      TRUE ~ "Other"
    )
  ) %>%
  group_by(ownership_type) %>%
  summarise(
    n_parcels = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    total_value = sum(assessed_value, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(n_parcels))
```

::: {.content-visible when-format="html"}
```{r ownership-breakdown-html}
ownership_stats %>%
  kable(
    col.names = c("Ownership Type", "# Parcels", "Total Acres", "Assessed Value"),
    digits = c(0, 0, 1, 0),
    format.args = list(big.mark = ",")
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  row_spec(0, bold = TRUE, background = "#445ca9", color = "white")
```
:::

::: {.content-visible when-format="pptx"}
```{r ownership-breakdown-pptx}
ownership_stats %>%
  kable(
    col.names = c("Ownership Type", "# Parcels", "Total Acres", "Assessed Value"),
    digits = c(0, 0, 1, 0),
    format.args = list(big.mark = ",")
  )
```
:::
### Property Use Types

```{r use-type-breakdown}
# Create use type classification
use_stats <- scored_parcels %>%
  mutate(
    primary_use = case_when(
      use_cemetery ~ "Cemetery",
      use_school ~ "School",
      use_parking ~ "Parking",
      use_open_space ~ "Open Space",
      use_residence ~ "Residential",
      use_church ~ "Church/Worship",
      TRUE ~ "Other/Mixed"
    )
  ) %>%
  group_by(primary_use) %>%
  summarise(
    n_parcels = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    avg_value = mean(assessed_value, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(n_parcels))

ggplot(use_stats, aes(x = reorder(primary_use, n_parcels), y = n_parcels)) +
  geom_col(fill = "#445ca9", alpha = 0.8) +
  geom_text(aes(label = n_parcels), hjust = -0.2, color = "#445ca9", fontface = "bold") +
  coord_flip() +
  labs(
    title = "Property Distribution by Primary Use",
    x = "",
    y = "Number of Parcels"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14, color = "#445ca9")
  )
```

## Geographic Distribution

### Parcels by Diocesan Region
```{r regional-distribution-calc, include=FALSE}
# Regional breakdown
regional_stats <- scored_parcels %>%
  group_by(dio_region) %>%
  summarise(
    n_parcels = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    pct_of_total_acres = (total_acres / sum(scored_parcels$area_acres, na.rm = TRUE)) * 100,
    avg_score = mean(development_score, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(n_parcels))
```

::: {.content-visible when-format="html"}
```{r regional-distribution-html}
regional_stats %>%
  kable(
    col.names = c("Diocesan Region", "# Parcels", "Total Acres", "% of Total Acreage", "Avg Dev Score"),
    digits = c(0, 0, 1, 1, 1)
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  row_spec(0, bold = TRUE, background = "#8baeaa", color = "white")
```
:::

::: {.content-visible when-format="pptx"}
```{r regional-distribution-pptx}
regional_stats %>%
  kable(
    col.names = c("Diocesan Region", "# Parcels", "Total Acres", "% of Total Acreage", "Avg Dev Score"),
    digits = c(0, 0, 1, 1, 1)
  )
```
:::

## Building and Asset Statistics

```{r building-stats, results='asis'}
# Building statistics
building_summary <- scored_parcels %>%
  summarise(
    total_parcels = n(),
    parcels_with_buildings = sum(!is.na(bldgcount) & bldgcount > 0, na.rm = TRUE),
    total_buildings = sum(bldgcount, na.rm = TRUE),
    avg_building_age = mean(2024 - year_built, na.rm = TRUE),
    total_assessed_value = sum(assessed_value, na.rm = TRUE),
    avg_assessed_value = mean(assessed_value, na.rm = TRUE)
  )

# Display as stat boxes
cat("::: {layout-ncol=3}\n")
cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", scales::comma(building_summary$total_buildings), "\n:::\n", sep = "")
cat("::: {.stat-label}\nTotal Buildings\n:::\n:::\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", round(building_summary$avg_building_age, 0), "\n:::\n", sep = "")
cat("::: {.stat-label}\nAvg Building Age (years)\n:::\n:::\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n$", scales::comma(building_summary$total_assessed_value / 1e6, accuracy = 0.1), "M\n:::\n", sep = "")
cat("::: {.stat-label}\nTotal Assessed Value\n:::\n:::\n")
cat(":::\n\n")
```

## Congregation Vitality Metrics

```{r congregation-metrics}
# Congregation statistics
cong_stats <- df_joined %>%
  filter(has_congregation) %>%
  summarise(
    parcels_with_cong_data = n(),
    parcels_under_30_attendance = sum(avg_attendance < 30, na.rm = TRUE),
    pct_under_30 = (parcels_under_30_attendance / n()) * 100,
    avg_attendance_all = mean(avg_attendance, na.rm = TRUE),
    avg_pledge_all = mean(avg_pledge, na.rm = TRUE),
    declining_pledges = sum(pct_change_pledge < 0, na.rm = TRUE)
  )

cat("**Key Congregation Metrics:**\n\n")
cat("- **Parcels with congregation data:** ", cong_stats$parcels_with_cong_data, "\n", sep = "")
cat("- **Parcels with <30 Sunday attendance:** ", cong_stats$parcels_under_30_attendance, 
    " (", round(cong_stats$pct_under_30, 1), "% of total diocese)\n", sep = "")
cat("- **Average Sunday attendance:** ", round(cong_stats$avg_attendance_all, 0), " people\n", sep = "")
cat("- **Average annual pledge:** $", scales::comma(cong_stats$avg_pledge_all, accuracy = 1), "\n", sep = "")
cat("- **Congregations with declining pledges:** ", cong_stats$declining_pledges, "\n\n", sep = "")
```

## Developable Land Summary

### Comprehensive Developability Analysis

```{r developable-summary, results='asis'}
# Summary of ALL developable land (not just top 10)
developable_summary <- scored_parcels %>%
  filter(development_score >= 45) %>%  # Tier 3 and above
  summarise(
    n_developable = n(),
    total_dev_acres = sum(area_acres, na.rm = TRUE),
    total_dev_value = sum(assessed_value, na.rm = TRUE),
    avg_attendance = mean(avg_attendance, na.rm = TRUE),
    avg_pledge = mean(avg_pledge, na.rm = TRUE),
    parcels_under_30 = sum(avg_attendance < 30, na.rm = TRUE)
  )

# By tier
tier_summary <- scored_parcels %>%
  filter(development_score >= 45) %>%
  group_by(development_tier) %>%
  summarise(
    n_parcels = n(),
    total_acres = sum(area_acres, na.rm = TRUE),
    total_value = sum(assessed_value, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(development_tier))

cat("### All Developable Properties (Score â‰¥45)\n\n")
```

::: {.content-visible when-format="html"}
```{r developable-stat-boxes-html, results='asis'}
cat("::: {layout-ncol=4}\n")
cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", developable_summary$n_developable, "\n:::\n", sep = "")
cat("::: {.stat-label}\nDevelopable Parcels\n:::\n:::\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", round(developable_summary$total_dev_acres, 1), "\n:::\n", sep = "")
cat("::: {.stat-label}\nDevelopable Acres\n:::\n:::\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n$", scales::comma(developable_summary$total_dev_value / 1e6, accuracy = 0.1), "M\n:::\n", sep = "")
cat("::: {.stat-label}\nAssessed Value\n:::\n:::\n")

cat("::: {.stat-box}\n")
cat("::: {.stat-number}\n", developable_summary$parcels_under_30, "\n:::\n", sep = "")
cat("::: {.stat-label}\nWith <30 Attendance\n:::\n:::\n")
cat(":::\n\n")
```
:::

::: {.content-visible when-format="pptx"}
```{r developable-bullets-pptx, results='asis'}
cat("**Key Metrics:**\n\n")
cat("- **", developable_summary$n_developable, "** developable parcels\n", sep = "")
cat("- **", round(developable_summary$total_dev_acres, 1), " acres** total\n", sep = "")
cat("- **$", scales::comma(developable_summary$total_dev_value / 1e6, accuracy = 0.1), "M** assessed value\n", sep = "")
cat("- **", developable_summary$parcels_under_30, "** with <30 attendance\n\n", sep = "")
```
:::
```{r continue-summary, results='asis'}
cat("### Breakdown by Development Tier\n\n")
```

::: {.content-visible when-format="html"}
```{r tier-breakdown-html}
tier_summary %>%
  kable(
    col.names = c("Tier", "# Parcels", "Total Acres", "Assessed Value"),
    digits = c(0, 0, 1, 0),
    format.args = list(big.mark = ",")
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```
:::

::: {.content-visible when-format="pptx"}
```{r tier-breakdown-pptx}
tier_summary %>%
  kable(
    col.names = c("Tier", "# Parcels", "Total Acres", "Assessed Value"),
    digits = c(0, 0, 1, 0),
    format.args = list(big.mark = ",")
  )
```
:::
---

# Property Profiles

::: {.content-visible when-format="pptx"}
## Top 3 Property Highlights

```{r top-3-highlights}
top_10 %>%
  slice_head(n = 3) %>%
  select(rank, site_address, area_acres, development_score, name) %>%
  mutate(
    congregation = if_else(is.na(name), "No active congregation", name)
  ) %>%
  select(-name) %>%
  kable(
    col.names = c("#", "Address", "Acres", "Score", "Congregation"),
    digits = 1
  )
```

**Common Factors:**

- Underutilized land (parking/open space)
- Strong location metrics
- Development-friendly zoning
- Financial sustainability needs
:::

::: {.content-hidden when-format="pptx"}
## Overview

The following section provides detailed profiles for each of the top 10 development opportunities. Each profile includes:

- Site characteristics and current use
- Congregation context (where applicable)
- Development opportunities and strategies
- Key considerations and next steps

```{r property-profiles, results='asis'}
create_property_profile <- function(rank_num) {
  property <- top_10 %>% filter(rank == rank_num)
  
  if(nrow(property) == 0) return(NULL)
  
  cat("\n\n## Property #", rank_num, " {.unnumbered}\n\n", sep = "")
  cat("### ", property$site_address, "\n", sep = "")
  cat("**", property$site_city, ", ", property$site_county, " County**\n\n", sep = "")
  
  tier_type <- case_when(
    property$development_score >= 75 ~ "important",
    property$development_score >= 60 ~ "tip",
    TRUE ~ "note"
  )
  
  cat(":::{.callout-", tier_type, "}\n", sep = "")
  cat("## Development Score: **", round(property$development_score, 1), "/100**\n\n", sep = "")
  cat("**", property$development_tier, "**\n", sep = "")
  cat(":::\n\n")
  
  cat("::: {layout-ncol=3}\n")
  cat("::: {}\n**", round(property$area_acres, 2), " acres**  \n", sep = "")
  cat("Property Size\n:::\n")
  
  cat("::: {}\n**", round(property$walkability_score, 1), "/100**  \n", sep = "")
  cat("Walkability\n:::\n")
  
  cat("::: {}\n**", 
      ifelse(!is.na(property$avg_attendance), 
             paste0(round(property$avg_attendance), " people"), "N/A"), "**  \n", sep = "")
  cat("Avg Attendance\n:::\n")
  cat(":::\n\n")
  
  cat("#### Site Characteristics\n\n")
  cat("- **Current Uses:**")
  uses <- c()
  if(!is.na(property$use_church) && property$use_church) uses <- c(uses, "Church building")
  if(!is.na(property$use_parking) && property$use_parking) uses <- c(uses, "Parking lot")
  if(!is.na(property$use_open_space) && property$use_open_space) uses <- c(uses, "Open space")
  if(length(uses) > 0) {
    cat(" ", paste(uses, collapse = ", "), "\n", sep = "")
  } else {
    cat(" Mixed use\n")
  }
  
  if(!is.na(property$name)) {
    cat("\n#### Congregation: ", property$name, "\n\n", sep = "")
    
    if(!is.na(property$pct_change_pledge)) {
      change_dir <- ifelse(property$pct_change_pledge < 0, "â†“ decreased", "â†‘ increased")
      cat("**Financial Trend:** Plate & pledge has ", change_dir, " by **", 
          abs(round(property$pct_change_pledge, 1)), "%** over the past decade.\n\n", sep = "")
    }
  }
  
  cat("#### Development Opportunities\n\n")
  if(!is.na(property$use_parking) && property$use_parking) {
    cat("ðŸ…¿ï¸ **Prime opportunity:** Underutilized parking can support structured parking with mixed-use above\n\n")
  }
  if(!is.na(property$area_acres) && property$area_acres > 1) {
    cat("ðŸ“ **Substantial site:** Large parcel enables phased development or creative master planning\n\n")
  }
  if(!is.na(property$walkability_score) && property$walkability_score > 10) {
    cat("ðŸš¶ **Walkable location:** Transit access supports reduced parking requirements and higher density\n\n")
  }
  
  cat("#### Recommended Next Steps\n\n")
  cat("1. Site feasibility study and geotechnical analysis\n")
  cat("2. Congregation leadership engagement\n")
  cat("3. Zoning review and density bonus evaluation\n")
  if(!is.na(property$financial_need) && property$financial_need >= 2) {
    cat("4. Ground lease financial modeling\n")
  }
  
  cat("\n---\n\n")
}

for(i in 1:10) {
  create_property_profile(i)
}
```
:::

---

::: {.content-hidden when-format="pptx"}
# Appendices {.unnumbered}

::: {.callout-note collapse="true"}
## Technical Methodology

**Scoring Algorithm Details**

Each property receives scores across six dimensions (0-100 scale), which are then weighted and combined:

1. **Size Score (20% weight):** Properties between 0.5-5 acres score highest (100 points)
2. **Use Score (25% weight):** Parking lots (95) and open space (90) score highest
3. **Location Score (20% weight):** Based on walkability index and transit access
4. **Financial Score (15% weight):** Congregation pledge trends indicate development need
5. **Market Score (10% weight):** Area median income and LIHTC eligibility
6. **Zoning Score (10% weight):** Development-friendly zoning receives 80 points

**Constraint penalties** are applied after the weighted average, with major penalties for:
- Flood zones: -40 points
- Significant wetlands (>25%): -35 points  
- Easements: -30 points
- Historic districts: -25 points

Final scores are capped between 0-100.
:::

::: {.callout-note collapse="true"}
## Data Processing Notes

**Congregation-Parcel Joining:** Properties were matched to congregation data using the `congr_name` field. Properties without matches received neutral financial scores.

**Missing Data Handling:** 
- Missing walkability scores defaulted to 0
- Missing income data received median market scores (50)
- Properties without area or coordinates were excluded

**Quality Filters:**
- Minimum parcel size: 0.1 acres
- Required valid lat/lon coordinates
- Valid building years: 1700-2025
:::
:::

::: {.content-visible when-format="pptx"}
# Conclusion

## Key Takeaways

**Strategic Opportunity:**

- 87 high-potential properties identified
- Substantial untapped value in portfolio
- Development supports congregational vitality

**Next Steps:**

1. Leadership review and prioritization
2. Feasibility studies on top 3 sites
3. Developer partnership solicitation
4. Community engagement planning

## Questions & Discussion
:::